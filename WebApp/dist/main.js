!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t){e.exports=BABYLON},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(){}return e.getRandomBoolean=function(){return Math.random()>=.5},e.getRandomNumberInRange=function(t,n,o){var i=Math.pow(10,o);return e.getRandomIntInRange(t*i,n*i)/i},e.getRandomIntInRange=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e.getRandomInt=function(t){var n=e.getRandomBoolean()?1:-1;return e.getRandomNegativeInt(t)*n},e.getRandomNegativeInt=function(t){return e.getRandomNegativeNumber(t)},e.getRandomNumber=function(t,n){var o=e.getRandomBoolean()?1:-1;return e.getRandomNegativeNumber(t,n)*o},e.getRandomNegativeNumber=function(e,t){e=e||1,t=t||0;var n=Math.round(Math.random()*Math.pow(10,e+t));return 0!==t&&(n/=Math.pow(10,t)),n},e.sort=function(e,t){return e.sort(function(e,n){return t(e)-t(n)}),e},e.shuffle=function(e){for(var t,n,o=e.length;0!==o;)n=Math.floor(Math.random()*o),t=e[o-=1],e[o]=e[n],e[n]=t;return e},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(1),i=function(){function e(){}return e.distanceVector=function(e,t){var n=e.x-t.x,o=e.y-t.y,i=e.z-t.z;return Math.sqrt(n*n+o*o+i*i)},e.getRandomVector3=function(e,t,n){return void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=!0),new BABYLON.Vector3(e?o.a.getRandomInt():0,t?o.a.getRandomInt():0,n?o.a.getRandomInt():0).normalize()},e.updatePosition=function(e,t,n){e.x+=t.x*n,e.y+=t.y*n,e.z+=t.z*n},e.positionToString=function(e){return["x","y","z"].map(function(t){return e[t].toFixed(2)}).join(", ")},e.getLineToEachOther=function(t){var n=[];return t.forEach(function(o,i){t.forEach(function(t,r){if(i<r){var a=e.distanceVector(o,t),s=i+"-"+r;n.push({key:s,from:o,to:t,distance:a})}})}),n},e}()},function(e,t){e.exports=$},function(e,t,n){"use strict";n.r(t);var o=n(0),i=n(3),r=n(1),a=n(2),s=function(){function e(){var e;this.texts=[],this.canvas=document.getElementById("renderCanvas"),this.engine=new o.Engine(this.canvas,!0),this.cameraLocations=[],this.bubbleSprays=[],this.colorsSetForParticle=[{diffuseColor:[253,245,134],glowColor:[255,252,193,.85]},{diffuseColor:[253,229,210],glowColor:[255,219,225,.85]},{diffuseColor:[252,247,255],glowColor:[255,249,254,.85]}].map(function(e){return e.diffuseColor=e.diffuseColor.map(function(e){return e/255}),e.glowColor=e.glowColor.map(function(e,t){return 3!==t?e/255:e}),e}),this.particles=[],this.linesForLinesystem=[],this.linesystem=null,this.translateFactor=0,this.chatRooms=[],this.highlightForLine=null,this.colorSetForLines=[[199,222,205],[192,231,164],[168,213,133]].map(function(e){return e.map(function(e){return e/255})}),this.glowColor=(e=[246/255,1,201/255,.84],new o.Color3(e[0],e[1],e[2])),this.textNodes=[]}return e.prototype.init=function(){var e=this;this.initScene(),this.getTexts(),this.getPoints(),this.registerRunRenderLoop(),i("#devPanel").show(),window.addEventListener("resize",function(){e.engine.resize()})},e.prototype.initScene=function(){var e=this.scene=new o.Scene(this.engine),t=this.camera=new o.UniversalCamera("Camera",new o.Vector3(0,0,-25),this.scene);t.speed=.5,t.setTarget(o.Vector3.Zero()),t.attachControl(this.canvas,!0),new o.HemisphericLight("HemiLight1",new o.Vector3(0,0,10),e).intensity=.8,new o.HemisphericLight("HemiLight2",new o.Vector3(0,0,-10),e).intensity=.8,this.lightOfCamera=new o.PointLight("lightOfCamera",new o.Vector3(0,0,0),e),this.lightOfCamera.diffuse=new o.Color3(1,1,1),this.lightOfCamera.specular=new o.Color3(.8,.8,.2),this.lightOfCamera.intensity=.3;var n=new o.StandardMaterial("skyBox",e);n.backFaceCulling=!1,n.reflectionTexture=new o.CubeTexture("assets/skybox/sb",e),n.reflectionTexture.coordinatesMode=o.Texture.SKYBOX_MODE,n.diffuseColor=new o.Color3(0,0,0),n.specularColor=new o.Color3(0,0,0),n.disableLighting=!0;var i=o.Mesh.CreateBox("skyBox",1500,e);i.material=n,i.infiniteDistance=!0,i.renderingGroupId=0},e.prototype.createBubbleSpray=function(e){var t=o.MeshBuilder.CreateSphere("s",{diameter:.08,segments:12},this.scene),n=new o.SolidParticleSystem("bubbleSpray",this.scene);n.addShape(t,20);var i=n.buildMesh();i.material=function(){var e=new o.StandardMaterial("bubbleMat",this.scene);return e.alpha=.1,e}.bind(this)(),i.position=e,t.dispose();var r;n.initParticles=function(){for(var e=0;e<this.nbParticles;e++)this.recycleParticle(this.particles[e])},n.recycleParticle=function(e){return e.position.x=0,e.position.y=0,e.position.z=0,e.velocity.x=.01*(Math.random()-.5)/3,e.velocity.y=.01*Math.random(),e.velocity.z=.01*(Math.random()-.5)/3,r=1*Math.random()+.2,e.scale.x=r,e.scale.y=r,e.scale.z=r,e.age=.8*Math.random(),e},n.updateParticle=function(e){return(e.position.y<0||e.age<0)&&n.recycleParticle(e),e.position.addInPlace(e.velocity),e.position.y+=.005,e.age-=.01,e},n.initParticles(),n.setParticles(),n.computeParticleColor=!1,n.computeParticleTexture=!1,n.computeParticleRotation=!1,this.bubbleSprays.push(n)},e.prototype.registerRunRenderLoop=function(){var e=this,t={x:0,y:0,z:0},n=this.camera.viewport.toGlobal(this.camera.getEngine(),null),r=i(".mark");this.engine.runRenderLoop(function(){if(e.bubbleSprays.forEach(function(e){return e.setParticles()}),e.cameraLocations.length>0){e.camera.position=e.cameraLocations.shift();e.cameraLocations.length>=1&&e.camera.setTarget(o.Vector3.Zero())}e.lightOfCamera.position=e.camera.position,e.translateLinesForTextNodes(),e.translateParticles(),e.bubbleSprays.forEach(function(e){return e.setParticles()}),e.scene.render(),e.updateDevPanel();var i=e.texts[0];if(i){var a=e.camera.getViewMatrix().multiply(e.camera.getProjectionMatrix()),s=o.Vector3.Project(t,i.computeWorldMatrix(!1),a,n);if(s.z>1)r.hide();else{r.show(),r.css("top",s.y+60),r.css("left",s.x);s.z;r.text(JSON.stringify(s))}}})},e.prototype.updateDevPanel=function(){document.getElementById("fps").innerHTML=this.engine.getFps().toFixed()+" fps",document.getElementById("coordinate").innerHTML=a.a.positionToString(this.camera.position)},e.prototype.onTextAdd=function(e,t,n,i){var r=new o.DynamicTexture("dynamic texture",{width:500,height:80},this.scene,!0);r.drawText(e,0,60,"60px verdana","white","true"),r.hasAlpha=!0;var a=o.MeshBuilder.CreatePlane("outputplane",{width:5,height:1},this.scene);a.billboardMode=o.AbstractMesh.BILLBOARDMODE_ALL,a.position=new o.Vector3(t,n,i),a.scaling.y=1,a._message=e;var s=a.material=new o.StandardMaterial("outputplane",this.scene);s.diffuseTexture=r,s.alpha=0,s.backFaceCulling=!1,this.texts.push(a)},e.prototype.onImageAdd=function(e,t,n,i){var r=o.Texture.CreateFromBase64String(e,"image-"+Date.now,this.scene),a=o.MeshBuilder.CreatePlane("outputplane",{width:5,height:5},this.scene);a.billboardMode=o.AbstractMesh.BILLBOARDMODE_ALL,a.position=new o.Vector3(t,n,i),a.scaling.y=1;var s=a.material=new o.StandardMaterial("outputplane",this.scene);s.diffuseTexture=r,s.specularColor=new o.Color3(0,0,0),s.emissiveColor=new o.Color3(1,1,1),s.backFaceCulling=!1},e.prototype.createParticle=function(e){var t=this,n=new o.Vector3(e.x+.1*r.a.getRandomIntInRange(-15,15),e.y+.1*r.a.getRandomIntInRange(-15,15),e.z+.1*r.a.getRandomIntInRange(-15,15)),i=r.a.getRandomIntInRange(0,2),s=this.colorsSetForParticle[i].diffuseColor,c=new o.Color3(s[0],s[1],s[2]),l=.001*r.a.getRandomIntInRange(50,70),u=o.Mesh.CreateSphere("core-colorSetIndex:"+i,2,l,this.scene);u.position=n;var h=u.material=new o.StandardMaterial("coreMaterial",this.scene);h.diffuseColor=c,h.emissiveColor=o.Color3.Black(),this.glowLayerForParticle||(this.glowLayerForParticle=new o.GlowLayer("glowLayerForParticle",this.scene),this.glowLayerForParticle.intensity=.5,this.glowLayerForParticle.customEmissiveColorSelector=function(e,n,o,i){var r=e.name.replace("core-colorSetIndex:",""),a=t.colorsSetForParticle[r].glowColor;i.set(a[0],a[1],a[2],a[3])}),this.glowLayerForParticle.addIncludedOnlyMesh(u);var d=a.a.getRandomVector3();this.particles.push({mesh:u,translateVector:d,duration:this.getDurationForParticle()})},e.prototype.startUpdateTextNodeWorker=function(){var e=this;if(window.Worker){var t=new Worker("dist/UpdateTextNodeWorker.js");t.onmessage=function(n){var o;(e.linesForLinesystem=n.data,0!==e.textNodes.length)&&(o=e.textNodes.map(function(t){return a.a.updatePosition(t.position,t.translateVector,t.scale*Math.cos(e.translateFactor)),t.position}),e.translateFactor+=.01,t.postMessage(o))},t.postMessage(this.textNodes)}},e.prototype.translateLinesForTextNodes=function(){if(0!==this.linesForLinesystem.length){this.linesystem&&!0,this.linesystem=o.MeshBuilder.CreateLineSystem("linesystem",{lines:this.linesForLinesystem,updatable:!0,instance:this.linesystem||null},this.scene),this.linesystem.color=o.Color3.White()}},e.prototype.translateParticles=function(){var e=this;if(0!==this.particles.length){this.particles.forEach(function(t){t.duration<=0&&(t.translateVector=a.a.getRandomVector3(),t.duration=e.getDurationForParticle()),a.a.updatePosition(t.mesh.position,t.translateVector,.003),t.duration-=1})}},e.prototype.getDurationForParticle=function(){return r.a.getRandomIntInRange(180,360)},e.prototype.getPoints=function(){var e=this;i.getJSON("apis/getPoints",function(t){var n=[];Object.keys(t).forEach(function(e,i){var a=t[e].map(function(e){return new o.Vector3(e.x,e.y,.006*r.a.getRandomNumber(3))});n[i]=a});var i=[];n.forEach(function(t){var n=a.a.getLineToEachOther(t),s=r.a.sort(n,function(e){return e.distance})[n.length-1],c=new o.Vector3(0,0,0);Object.keys(c).forEach(function(e){c[e]=(s.from[e]+s.to[e])/2}),e.chatRooms.push(c),e.createBubbleSpray(c);for(var l=0;l<10;l++)e.createParticle(c);i=i.concat(n.slice(0,120))}),console.log("line count: "+i.length),e.drawLine(i)})},e.prototype.drawLine=function(e){var t=this;if(0!==e.length){var n=this.highlightForLine=this.highlightForLine||function(){var e=new o.HighlightLayer("highlightForLine",this.scene);return e.innerGlow=!1,e}.bind(this)(),i=this.colorSetForLines.map(function(e,n){var i=new o.Color3(e[0],e[1],e[2]),r=new o.StandardMaterial("lineMat"+n,t.scene);return r.diffuseColor=i,r}),a=[[],[],[]];e.forEach(function(e,n){var s=r.a.getRandomIntInRange(0,2),c=o.MeshBuilder.CreateTube("line"+n,{path:[e.from,e.to],radius:.03,updatable:!1},t.scene);c.material=i[s],a[s].push(c)}),a.forEach(function(e){if(0!==e.length){var i=o.Mesh.MergeMeshes(e,!0,!1);n.addMesh(i,t.glowColor)}})}},e.prototype.getTexts=function(){var e=this,t=new Image;t.src="assets/textImage/image.png",t.onload=function(){var n=document.createElement("canvas"),i=n.height=t.height,s=n.width=t.width,c=n.getContext("2d");c.drawImage(t,0,0,s,i);for(var l=c.getImageData(64,64,64,64),u=[],h=l.data.length,d=0;d<h;d+=4){var g=l.data[d],f=l.data[d+1],p=l.data[d+2],m=.299*g+.587*f+.114*p,y=d/4+1,v=Math.floor(y/64),w=y%64;u.push({x:w,y:v,r:g,g:f,b:p,brightness:m})}e.textNodes=u.filter(function(e){return e.brightness>100}).map(function(e,t){return{position:new o.Vector3(.15*(e.x-32),-1*(e.y-32)*.15,-15+r.a.getRandomNumberInRange(0,2,2)),scale:r.a.getRandomNumberInRange(-.05,.05,3),translateVector:a.a.getRandomVector3(!1,!1)}}),e.startUpdateTextNodeWorker()}},e.prototype.zoomIn=function(){var e=new o.Vector3(0,0,0),t=this.chatRooms[r.a.getRandomIntInRange(0,this.chatRooms.length-1)],n=t?new o.Vector3(3*t.x,3*t.y,0):o.Vector3.Zero(),i=o.Curve3.CreateHermiteSpline(this.camera.position,e,n,e,300).getPoints();this.cameraLocations=i},e}(),c=function(){function e(){this.afterLogin=function(){}}return e.prototype.init=function(){gapi.load("client",this.initClient.bind(this)),this.wordCardsAnimation()},e.prototype.wordCardsAnimation=function(){var e=function(t){if(0!==t.length){var n={fadeIn:3e3,sustain:1e3,fadeOut:t.length>1?2e3:null};!function(e,t,n){var o=$(e);o.fadeIn(t.fadeIn,void 0,function(){t.fadeOut&&setTimeout(function(){o.fadeOut(t.fadeOut,void 0,function(){n()})},t.sustain||0)})}(t.shift(),n,function(){e(t)})}},t=$("#loginPanel > div");e(t.toArray())},e.prototype.initClient=function(){var e=this;gapi.client.init({clientId:"380947346613-l6gvf9laj9fuko3ljph9ej99olo5qa3k.apps.googleusercontent.com",apiKey:"AIzaSyBmozdLmtDDry_ah4NhYPqOTeZ2wr9Er2A",discoveryDocs:["https://people.googleapis.com/$discovery/rest?version=v1"],scope:"profile"}).then(function(){gapi.auth2.getAuthInstance().isSignedIn.get()?e.queryUser():e.setSignInButton()})},e.prototype.setSignInButton=function(){gapi.auth2.getAuthInstance().isSignedIn.listen(this.login.bind(this)),$("#signinButton").on("click",function(){return gapi.auth2.getAuthInstance().signIn()})},e.prototype.queryUser=function(){var e=this;gapi.client.people.people.get({resourceName:"people/me","requestMask.includeField":"person.names"}).then(function(t){var n=t.result.names[0].displayName;e.setLoiginButton(n)})},e.prototype.setLoiginButton=function(e){$("#signInWrapper .buttonText").text(e),$("#signinButton").on("click",this.login.bind(this))},e.prototype.login=function(){var e=$("#loginPanel");e.animate({opacity:0},2e3,function(){return e.hide()}),this.afterLogin()},e}(),l=function(){return function(){}}(),u=new c;u.init();var h=new s;h.init(),u.afterLogin=h.zoomIn.bind(h);new l}]);