!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=BABYLON},function(e,t){e.exports=$},function(e,t,n){"use strict";n.r(t);var i=n(0),a=n(1),o=new(function(){function e(){}return e.prototype.getRandomInt=function(){var e=this.getRandomNegativeInt()>4?1:-1;return this.getRandomNegativeInt()*e},e.prototype.getRandomIntInRange=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e.prototype.getRandomNegativeInt=function(){return Math.round(10*Math.random())},e}()),r=function(){function e(){this.addText=null,this.addImage=null}return e.prototype.initPanel=function(e,t){this.addText=e,this.addImage=t,a("#js-sent").on("click",this.handleText.bind(this)),a("#js-upload").on("change",this.handleFiles.bind(this))},e.prototype.handleText=function(){var e=this,t=a(".js-input"),n=String(t.val());if(n){t.val("").focus(),this.addText(n,2*o.getRandomInt(),o.getRandomInt(),-3+o.getRandomNegativeInt());var i=a(".mask");i.addClass("flash"),setTimeout(function(){i.removeClass("flash")},500),window.setTimeout(function(){e.addText(n+"! "+n+"! "+n+"!!!",2*o.getRandomInt(),o.getRandomInt(),-3+o.getRandomNegativeInt())},700)}},e.prototype.handleFiles=function(e){var t=this,n=e.currentTarget.files[0];if(n){var i=new FileReader;i.addEventListener("load",function(e){var n=e.target.result;t.addImage(n,2*o.getRandomInt(),o.getRandomInt(),-3+o.getRandomNegativeInt())}),i.readAsDataURL(n),a.get("apis/uploadImage").done(function(e){console.log(e)}).fail(function(e){console.log(e)})}},e}();(new(function(){function e(){this.texts=[],this.panel=new r,this.canvas=document.getElementById("renderCanvas"),this.engine=new i.Engine(this.canvas,!0)}return e.prototype.init=function(){var e=this;this.initScene(),this.createSPS(),this.drawLine(),this.registerBeforeRender(),this.runRenderLoop(),this.panel.initPanel(this.addText.bind(this),this.addImage.bind(this)),window.addEventListener("resize",function(){e.engine.resize()})},e.prototype.initScene=function(){var e=this.scene=new i.Scene(this.engine),t=this.camera=new i.UniversalCamera("Camera",new i.Vector3(0,0,-30),this.scene);t.speed=.5,t.setTarget(i.Vector3.Zero()),t.attachControl(this.canvas,!0),new i.HemisphericLight("HemiLight",new i.Vector3(0,0,-10),e),this.light=new i.PointLight("light",new i.Vector3(0,0,0),e),this.light.intensity=.8,this.lightOfCamera=new i.PointLight("lightOfCamera",new i.Vector3(0,0,0),e),this.lightOfCamera.diffuse=new i.Color3(1,1,1),this.lightOfCamera.specular=new i.Color3(.8,.8,.2),this.spotLight=new i.SpotLight("spotLight",new i.Vector3(-10,0,0),new i.Vector3(0,0,0),Math.PI/4,20,e),this.spotLight.diffuse=new i.Color3(1,0,0),this.spotLight.specular=new i.Color3(1,0,0),this.spotLight.intensity=.8;var n=new i.StandardMaterial("skyBox",e);n.backFaceCulling=!1,n.reflectionTexture=new i.CubeTexture("https://www.babylonjs.com/assets/skybox/nebula",e),n.reflectionTexture.coordinatesMode=i.Texture.SKYBOX_MODE,n.diffuseColor=new i.Color3(0,0,0),n.specularColor=new i.Color3(0,0,0),n.disableLighting=!0,i.Mesh.CreateBox("skyBox",1500,e).material=n},e.prototype.createSPS=function(){var e=i.MeshBuilder.CreateSphere("s",{diameter:1,segments:12},this.scene),t=new i.SolidParticleSystem("SPS",this.scene);t.addShape(e,20);var n=t.buildMesh();n.material=function(){var e=new i.StandardMaterial("mat",this.scene);return e.alpha=.1,e}.bind(this)(),n.position.x=0,n.position.y=0,n.position.z=0,e.dispose();var a;t.initParticles=function(){for(var e=0;e<this.nbParticles;e++)this.recycleParticle(this.particles[e])},t.recycleParticle=function(e){return e.position.x=0,e.position.y=0,e.position.z=0,e.velocity.x=.1*(Math.random()-.5)/3,e.velocity.y=.1*Math.random(),e.velocity.z=.1*(Math.random()-.5)/3,a=1*Math.random()+.2,e.scale.x=a,e.scale.y=a,e.scale.z=a,e.age=.8*Math.random(),e},t.updateParticle=function(e){return(e.position.y<0||e.age<0)&&this.recycleParticle(e),e.position.addInPlace(e.velocity),e.position.y+=.05,e.age-=.01,e},t.initParticles(),t.setParticles(),t.computeParticleColor=!1,t.computeParticleTexture=!1,t.computeParticleRotation=!1,this.sps=t},e.prototype.registerBeforeRender=function(){var e=this,t=0;this.scene.registerBeforeRender(function(){e.sps.setParticles(),e.lightOfCamera.position=e.camera.position,t+=.01;var n=Math.cos(t);e.light.intensity=Math.cos(n)})},e.prototype.runRenderLoop=function(){var e=this,t={x:0,y:0,z:0},n=this.camera.viewport.toGlobal(this.camera.getEngine(),null),o=a(".mark");this.engine.runRenderLoop(function(){e.scene.render();var a=e.texts[0];if(a){var r=e.camera.getViewMatrix().multiply(e.camera.getProjectionMatrix()),s=i.Vector3.Project(t,a.computeWorldMatrix(!1),r,n);if(s.z>1)o.hide();else{o.show(),o.css("top",s.y+60),o.css("left",s.x);s.z;o.text(JSON.stringify(s))}}})},e.prototype.addText=function(e,t,n,a){var o=new i.DynamicTexture("dynamic texture",{width:500,height:80},this.scene,!0);o.drawText(e,0,60,"60px verdana","white","true",!0);var r=i.MeshBuilder.CreatePlane("outputplane",{width:5,height:1},this.scene);r.billboardMode=i.AbstractMesh.BILLBOARDMODE_ALL,r.position=new i.Vector3(t,n,a),r.scaling.y=1,r._message=e;var s=r.material=new i.StandardMaterial("outputplane",this.scene);s.diffuseTexture=o,s.specularColor=new i.Color3(0,0,0),s.emissiveColor=new i.Color3(1,1,1),s.backFaceCulling=!1,this.texts.push(r),this.createParticle()},e.prototype.addImage=function(e,t,n,a){var o=i.Texture.CreateFromBase64String(e,"image-"+Date.now,this.scene),r=i.MeshBuilder.CreatePlane("outputplane",{width:5,height:5},this.scene);r.billboardMode=i.AbstractMesh.BILLBOARDMODE_ALL,r.position=new i.Vector3(t,n,a),r.scaling.y=1;var s=r.material=new i.StandardMaterial("outputplane",this.scene);s.diffuseTexture=o,s.specularColor=new i.Color3(0,0,0),s.emissiveColor=new i.Color3(1,1,1),s.backFaceCulling=!1},e.prototype.createParticle=function(){var e=i.MeshBuilder.CreateIcoSphere("ico",{radius:.2*o.getRandomNegativeInt(),radiusY:.2*o.getRandomNegativeInt(),subdivisions:.5*o.getRandomNegativeInt()},this.scene);e.position=new i.Vector3(o.getRandomIntInRange(-30,30),o.getRandomIntInRange(-30,30),o.getRandomIntInRange(-30,30));var t=new i.StandardMaterial("icoMaterial",this.scene);t.diffuseColor=new i.Color3(.1*o.getRandomNegativeInt(),.1*o.getRandomNegativeInt(),.1*o.getRandomNegativeInt()),t.alpha=.6,e.material=t},e.prototype.drawLine=function(){var e=this;a.getJSON("apis/getPoints",function(t){var n=[];Object.keys(t).forEach(function(e){return n=n.concat(t[e].map(function(e){return new i.Vector3(e.x,e.y,o.getRandomNegativeInt())}))});var a=i.MeshBuilder.CreateTube("line",{path:n,radius:.05,updatable:!0,instance:null},e.scene),r=new i.StandardMaterial("greenMat",e.scene);r.diffuseColor=new i.Color3(0,1,0),r.alpha=.2,a.material=r})},e}())).init()}]);