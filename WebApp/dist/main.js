!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=BABYLON},function(e,t){e.exports=$},function(e,t,n){"use strict";n.r(t);var o=n(0),i=n(1),r=new(function(){function e(){}return e.prototype.getRandomInt=function(){var e=this.getRandomNegativeInt()>4?1:-1;return this.getRandomNegativeInt()*e},e.prototype.getRandomIntInRange=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e.prototype.getRandomNegativeInt=function(){return Math.round(10*Math.random())},e.prototype.distanceVector=function(e,t){var n=e.x-t.x,o=e.y-t.y,i=e.z-t.z;return Math.sqrt(n*n+o*o+i*i)},e}()),a=function(){function e(){this.addText=null,this.addImage=null}return e.prototype.initPanel=function(e,t){this.addText=e,this.addImage=t,i("#js-sent").on("click",this.handleText.bind(this)),i("#js-upload").on("change",this.handleFiles.bind(this))},e.prototype.handleText=function(){var e=this,t=i(".js-input"),n=String(t.val());if(n){t.val("").focus(),this.addText(n,2*r.getRandomInt(),r.getRandomInt(),-3+r.getRandomNegativeInt());var o=i(".mask");o.addClass("flash"),setTimeout(function(){o.removeClass("flash")},500),window.setTimeout(function(){e.addText(n+"! "+n+"! "+n+"!!!",2*r.getRandomInt(),r.getRandomInt(),-3+r.getRandomNegativeInt())},700)}},e.prototype.handleFiles=function(e){var t=this,n=e.currentTarget.files[0];if(n){var o=new FileReader;o.addEventListener("load",function(e){var n=e.target.result;t.addImage(n,2*r.getRandomInt(),r.getRandomInt(),-3+r.getRandomNegativeInt())}),o.readAsDataURL(n),i.get("apis/uploadImage").done(function(e){console.log(e)}).fail(function(e){console.log(e)})}},e}(),s=function(){function e(){this.texts=[],this.panel=new a,this.canvas=document.getElementById("renderCanvas"),this.engine=new o.Engine(this.canvas,!0),this.particles=[]}return e.prototype.init=function(){var e=this;this.initScene(),this.createBubbleSpray(),this.drawLine();for(var t=0;t<50;t++)this.createParticle();this.registerBeforeRender(),this.runRenderLoop(),this.panel.initPanel(this.addText.bind(this),this.addImage.bind(this)),window.addEventListener("resize",function(){e.engine.resize()})},e.prototype.initScene=function(){var e=this.scene=new o.Scene(this.engine),t=this.camera=new o.UniversalCamera("Camera",new o.Vector3(0,0,-30),this.scene);t.speed=.5,t.setTarget(o.Vector3.Zero()),t.attachControl(this.canvas,!0),new o.HemisphericLight("HemiLight",new o.Vector3(0,0,0),e),this.lightOfCamera=new o.PointLight("lightOfCamera",new o.Vector3(0,0,0),e),this.lightOfCamera.diffuse=new o.Color3(1,1,1),this.lightOfCamera.specular=new o.Color3(.8,.8,.2);var n=new o.StandardMaterial("skyBox",e);n.backFaceCulling=!1,n.reflectionTexture=new o.CubeTexture("assets/skybox/sb",e),n.reflectionTexture.coordinatesMode=o.Texture.SKYBOX_MODE,n.diffuseColor=new o.Color3(0,0,0),n.specularColor=new o.Color3(0,0,0),n.disableLighting=!0;var i=o.Mesh.CreateBox("skyBox",1500,e);i.material=n,i.infiniteDistance=!0,i.renderingGroupId=0},e.prototype.createBubbleSpray=function(){var e=o.MeshBuilder.CreateSphere("s",{diameter:.08,segments:12},this.scene),t=new o.SolidParticleSystem("bubbleSpray",this.scene);t.addShape(e,20);var n=t.buildMesh();n.material=function(){var e=new o.StandardMaterial("mat",this.scene);return e.alpha=.1,e}.bind(this)(),n.position.x=0,n.position.y=0,n.position.z=0,e.dispose();var i;t.initParticles=function(){for(var e=0;e<this.nbParticles;e++)this.recycleParticle(this.particles[e])},t.recycleParticle=function(e){return e.position.x=0,e.position.y=0,e.position.z=0,e.velocity.x=.01*(Math.random()-.5)/3,e.velocity.y=.01*Math.random(),e.velocity.z=.01*(Math.random()-.5)/3,i=1*Math.random()+.2,e.scale.x=i,e.scale.y=i,e.scale.z=i,e.age=.8*Math.random(),e},t.updateParticle=function(e){return(e.position.y<0||e.age<0)&&t.recycleParticle(e),e.position.addInPlace(e.velocity),e.position.y+=.005,e.age-=.01,e},t.initParticles(),t.setParticles(),t.computeParticleColor=!1,t.computeParticleTexture=!1,t.computeParticleRotation=!1,this.bubbleSpray=t},e.prototype.registerBeforeRender=function(){var e=this,t=0;this.scene.registerBeforeRender(function(){e.bubbleSpray.setParticles(),e.lightOfCamera.position=e.camera.position,t+=.01;Math.cos(t);e.translateParticles()})},e.prototype.runRenderLoop=function(){var e=this,t={x:0,y:0,z:0},n=this.camera.viewport.toGlobal(this.camera.getEngine(),null),r=i(".mark");this.engine.runRenderLoop(function(){e.scene.render();var i=e.texts[0];if(i){var a=e.camera.getViewMatrix().multiply(e.camera.getProjectionMatrix()),s=o.Vector3.Project(t,i.computeWorldMatrix(!1),a,n);if(s.z>1)r.hide();else{r.show(),r.css("top",s.y+60),r.css("left",s.x);s.z;r.text(JSON.stringify(s))}}})},e.prototype.addText=function(e,t,n,i){var r=new o.DynamicTexture("dynamic texture",{width:500,height:80},this.scene,!0);r.drawText(e,0,60,"60px verdana","white","true"),r.hasAlpha=!0;var a=o.MeshBuilder.CreatePlane("outputplane",{width:5,height:1},this.scene);a.billboardMode=o.AbstractMesh.BILLBOARDMODE_ALL,a.position=new o.Vector3(t,n,i),a.scaling.y=1,a._message=e;var s=a.material=new o.StandardMaterial("outputplane",this.scene);s.diffuseTexture=r,s.alpha=0,s.backFaceCulling=!1,this.texts.push(a)},e.prototype.addImage=function(e,t,n,i){var r=o.Texture.CreateFromBase64String(e,"image-"+Date.now,this.scene),a=o.MeshBuilder.CreatePlane("outputplane",{width:5,height:5},this.scene);a.billboardMode=o.AbstractMesh.BILLBOARDMODE_ALL,a.position=new o.Vector3(t,n,i),a.scaling.y=1;var s=a.material=new o.StandardMaterial("outputplane",this.scene);s.diffuseTexture=r,s.specularColor=new o.Color3(0,0,0),s.emissiveColor=new o.Color3(1,1,1),s.backFaceCulling=!1},e.prototype.createParticle=function(){var e=[5,5,-8],t=new o.Vector3(e[0]+.1*r.getRandomIntInRange(-15,15),e[1]+.1*r.getRandomIntInRange(-15,15),e[2]+.1*r.getRandomIntInRange(-15,15)),n=[{diffuseColor:[253,245,134],glowColor:[255,252,193,.85]},{diffuseColor:[253,229,210],glowColor:[255,219,225,.85]},{diffuseColor:[252,247,255],glowColor:[255,249,254,.85]}].map(function(e){return e.diffuseColor=e.diffuseColor.map(function(e){return e/255}),e.glowColor=e.glowColor.map(function(e,t){return 3!==t?e/255:e}),e}),i=r.getRandomIntInRange(0,2),a=n[i].diffuseColor,s=new o.Color3(a[0],a[1],a[2]),c=.001*r.getRandomIntInRange(50,70),l=o.Mesh.CreateSphere("core-colorSetIndex:"+i,2,c,this.scene);l.position=t;var u=l.material=new o.StandardMaterial("coreMaterial",this.scene);u.diffuseColor=s,u.emissiveColor=o.Color3.Black(),this.glowLayerForParticle||(this.glowLayerForParticle=new o.GlowLayer("glowLayerForParticle",this.scene),this.glowLayerForParticle.intensity=.5,this.glowLayerForParticle.customEmissiveColorSelector=function(e,t,o,i){var r=e.name.replace("core-colorSetIndex:",""),a=n[r].glowColor;i.set(a[0],a[1],a[2],a[3])}),this.glowLayerForParticle.addIncludedOnlyMesh(l);var d=this.getRandomVector3();this.particles.push({mesh:l,translateVector:d,duration:this.getDurationForParticle()})},e.prototype.translateParticles=function(){var e=this;this.particles.forEach(function(t){t.duration<=0&&(t.translateVector=e.getRandomVector3(),t.duration=e.getDurationForParticle());var n=t.translateVector;t.mesh.position.x+=.003*n.x,t.mesh.position.y+=.003*n.y,t.mesh.position.z+=.003*n.z,t.duration-=1})},e.prototype.getRandomVector3=function(){return new o.Vector3(r.getRandomInt(),r.getRandomInt(),r.getRandomInt()).normalize()},e.prototype.getDurationForParticle=function(){return r.getRandomIntInRange(180,360)},e.prototype.drawLine=function(){var e=this;i.getJSON("apis/getPoints",function(t){var n=[];Object.keys(t).forEach(function(e){var i=t[e].map(function(e){return new o.Vector3(e.x,e.y,r.getRandomNegativeInt())});n=n.concat(i)});var i=[];n.forEach(function(e,t){n.forEach(function(n,o){if(t<o){var a=r.distanceVector(e,n);if(a<2.2){var s=t+"-"+o;i.push({key:s,from:e,to:n,distance:a})}}})}),console.log("max distance: 2.2, line count: "+i.length);var a=[[199,222,205],[192,231,164],[168,213,133]].map(function(e){return e.map(function(e){return e/255})}),s=[246/255,1,201/255,.84];e.glowLayerForLine||(e.glowLayerForLine=new o.GlowLayer("glowLayerForLine",e.scene),e.glowLayerForLine.intensity=.2,e.glowLayerForLine.customEmissiveColorSelector=function(e,t,n,o){o.set(s[0],s[1],s[2],s[3])});var c=o.Color3.Black();i.forEach(function(t,n){var i=a[r.getRandomIntInRange(0,2)],s=new o.Color3(i[0],i[1],i[2]),l=new o.StandardMaterial("greenMat"+n,e.scene);l.diffuseColor=s,l.emissiveColor=c;var u=o.MeshBuilder.CreateTube("line"+n,{path:[t.from,t.to],radius:.03,updatable:!1,instance:null},e.scene);u.material=l,e.glowLayerForLine.addIncludedOnlyMesh(u)})})},e}(),c=function(){function e(){}return e.prototype.init=function(){gapi.load("client",this.initClient.bind(this))},e.prototype.initClient=function(){var e=this;gapi.client.init({clientId:"380947346613-l6gvf9laj9fuko3ljph9ej99olo5qa3k.apps.googleusercontent.com",apiKey:"AIzaSyBmozdLmtDDry_ah4NhYPqOTeZ2wr9Er2A",discoveryDocs:["https://people.googleapis.com/$discovery/rest?version=v1"],scope:"profile"}).then(function(){gapi.auth2.getAuthInstance().isSignedIn.listen(e.updateSigninStatus.bind(e)),e.updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get())})},e.prototype.updateSigninStatus=function(e){},e}();(new s).init(),(new c).init()}]);