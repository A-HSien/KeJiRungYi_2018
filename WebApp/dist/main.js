!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t,e){t.exports=BABYLON},function(t,e,n){"use strict";n.d(e,"a",function(){return o});var o=function(){function t(){}return t.getRandomBoolean=function(){return Math.random()>=.5},t.getRandomNumberInRange=function(e,n,o){var i=Math.pow(10,o);return t.getRandomIntInRange(e*i,n*i)/i},t.getRandomIntInRange=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t.getRandomInt=function(e){var n=t.getRandomBoolean()?1:-1;return t.getRandomNegativeInt(e)*n},t.getRandomNegativeInt=function(e){return t.getRandomNegativeNumber(e)},t.getRandomNumber=function(e,n){var o=t.getRandomBoolean()?1:-1;return t.getRandomNegativeNumber(e,n)*o},t.getRandomNegativeNumber=function(t,e){t=t||1,e=e||0;var n=Math.round(Math.random()*Math.pow(10,t+e));return 0!==e&&(n/=Math.pow(10,e)),n},t.sort=function(t,e){return t.sort(function(t,n){return e(t)-e(n)}),t},t.shuffle=function(t){for(var e,n,o=t.length;0!==o;)n=Math.floor(Math.random()*o),e=t[o-=1],t[o]=t[n],t[n]=e;return t},t}()},function(t,e,n){"use strict";n.d(e,"a",function(){return i});var o=n(1),i=function(){function t(){}return t.distanceVector=function(t,e){var n=t.x-e.x,o=t.y-e.y,i=t.z-e.z;return Math.sqrt(n*n+o*o+i*i)},t.addVector=function(t,e){return new BABYLON.Vector3(t.x+e.x,t.y+e.y,t.z+e.z)},t.subtractVector=function(t,e){return new BABYLON.Vector3(t.x-e.x,t.y-e.y,t.z-e.z)},t.getRandomVector3=function(t,e,n){return void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=!0),new BABYLON.Vector3(t?o.a.getRandomInt():0,e?o.a.getRandomInt():0,n?o.a.getRandomInt():0).normalize()},t.updatePosition=function(t,e,n){t.x+=e.x*n,t.y+=e.y*n,t.z+=e.z*n},t.positionToString=function(t){return["x","y","z"].map(function(e){return t[e].toFixed(2)}).join(", ")},t.getLineToEachOther=function(e){var n=[];return e.forEach(function(o,i){e.forEach(function(e,r){if(i<r){var a=t.distanceVector(o,e),s=i+"-"+r;n.push({key:s,from:o,to:e,distance:a})}})}),n},t}()},function(t,e){t.exports=React},function(t,e){t.exports=$},function(t,e){t.exports=ReactDOM},function(t,e,n){"use strict";n.r(e);var o,i,r=n(3),a=n(5),s=n(0),c=n(4),l=n(1),u=n(2),h=function(){function t(){var t;this.texts=[],this.canvas=document.getElementById("renderCanvas"),this.engine=new s.Engine(this.canvas,!0),this.cameraLocations=[],this.bubbleSprays=[],this.colorsSetForParticle=[{diffuseColor:[253,245,134],glowColor:[255,252,193,.85]},{diffuseColor:[253,229,210],glowColor:[255,219,225,.85]},{diffuseColor:[252,247,255],glowColor:[255,249,254,.85]}].map(function(t){return t.diffuseColor=t.diffuseColor.map(function(t){return t/255}),t.glowColor=t.glowColor.map(function(t,e){return 3!==e?t/255:t}),t}),this.particles=[],this.linesForLinesystem=[],this.linesystem=null,this.translateFactor=0,this.translateType="Simple",this.chatRoomsNodes=[],this.chatRoomsCenter=[],this.linesForChatRooms=[],this.highlightForLine=null,this.colorSetForLines=[[199,222,205],[192,231,164],[168,213,133]].map(function(t){return t.map(function(t){return t/255})}),this.glowColor=(t=[246/255,1,201/255,.84],new s.Color3(t[0],t[1],t[2])),this.textNodes=[]}return t.prototype.init=function(){var t=this;this.initScene(),this.getTexts(),this.getPoints(),this.registerRunRenderLoop(),c("#devPanel").show(),window.addEventListener("resize",function(){t.engine.resize()})},t.prototype.initScene=function(){var t=this.scene=new s.Scene(this.engine),e=this.camera=new s.UniversalCamera("Camera",new s.Vector3(0,0,-25),this.scene);e.speed=.5,e.setTarget(s.Vector3.Zero()),e.attachControl(this.canvas,!0),new s.HemisphericLight("HemiLight1",new s.Vector3(0,0,10),t).intensity=.8,new s.HemisphericLight("HemiLight2",new s.Vector3(0,0,-10),t).intensity=.8,this.lightOfCamera=new s.PointLight("lightOfCamera",new s.Vector3(0,0,0),t),this.lightOfCamera.diffuse=new s.Color3(1,1,1),this.lightOfCamera.specular=new s.Color3(.8,.8,.2),this.lightOfCamera.intensity=.3;var n=new s.StandardMaterial("skyBox",t);n.backFaceCulling=!1,n.reflectionTexture=new s.CubeTexture("assets/skybox/sb",t),n.reflectionTexture.coordinatesMode=s.Texture.SKYBOX_MODE,n.diffuseColor=new s.Color3(0,0,0),n.specularColor=new s.Color3(0,0,0),n.disableLighting=!0;var o=s.Mesh.CreateBox("skyBox",1500,t);o.material=n,o.infiniteDistance=!0,o.renderingGroupId=0},t.prototype.createBubbleSpray=function(t){var e=s.MeshBuilder.CreateSphere("s",{diameter:.08,segments:12},this.scene),n=new s.SolidParticleSystem("bubbleSpray",this.scene);n.addShape(e,20);var o=n.buildMesh();o.material=function(){var t=new s.StandardMaterial("bubbleMat",this.scene);return t.alpha=.1,t}.bind(this)(),o.position=t,e.dispose();var i;n.initParticles=function(){for(var t=0;t<this.nbParticles;t++)this.recycleParticle(this.particles[t])},n.recycleParticle=function(t){return t.position.x=0,t.position.y=0,t.position.z=0,t.velocity.x=.01*(Math.random()-.5)/3,t.velocity.y=.01*Math.random(),t.velocity.z=.01*(Math.random()-.5)/3,i=1*Math.random()+.2,t.scale.x=i,t.scale.y=i,t.scale.z=i,t.age=.8*Math.random(),t},n.updateParticle=function(t){return(t.position.y<0||t.age<0)&&n.recycleParticle(t),t.position.addInPlace(t.velocity),t.position.y+=.005,t.age-=.01,t},n.initParticles(),n.setParticles(),n.computeParticleColor=!1,n.computeParticleTexture=!1,n.computeParticleRotation=!1,this.bubbleSprays.push(n)},t.prototype.registerRunRenderLoop=function(){var t=this;this.camera.viewport.toGlobal(this.camera.getEngine(),null),c(".mark");this.engine.runRenderLoop(function(){if(t.bubbleSprays.forEach(function(t){return t.setParticles()}),t.cameraLocations.length>0){t.camera.position=t.cameraLocations.shift();t.cameraLocations.length>=1&&(t.camera.setTarget(s.Vector3.Zero()),1===t.cameraLocations.length&&t.createBubbleSprayAndParticles())}t.lightOfCamera.position=t.camera.position,t.translateLinesForTextNodes(),t.translateParticles(),t.bubbleSprays.forEach(function(t){return t.setParticles()}),t.scene.render(),t.updateDevPanel()})},t.prototype.updateDevPanel=function(){document.getElementById("fps").innerHTML=this.engine.getFps().toFixed()+" fps",document.getElementById("coordinate").innerHTML=u.a.positionToString(this.camera.position)},t.prototype.onTextAdd=function(t,e,n,o){var i=new s.DynamicTexture("dynamic texture",{width:500,height:80},this.scene,!0);i.drawText(t,0,60,"60px verdana","white","true"),i.hasAlpha=!0;var r=s.MeshBuilder.CreatePlane("outputplane",{width:5,height:1},this.scene);r.billboardMode=s.AbstractMesh.BILLBOARDMODE_ALL,r.position=new s.Vector3(e,n,o),r.scaling.y=1,r._message=t;var a=r.material=new s.StandardMaterial("outputplane",this.scene);a.diffuseTexture=i,a.alpha=0,a.backFaceCulling=!1,this.texts.push(r)},t.prototype.onImageAdd=function(t,e,n,o){var i=s.Texture.CreateFromBase64String(t,"image-"+Date.now,this.scene),r=s.MeshBuilder.CreatePlane("outputplane",{width:5,height:5},this.scene);r.billboardMode=s.AbstractMesh.BILLBOARDMODE_ALL,r.position=new s.Vector3(e,n,o),r.scaling.y=1;var a=r.material=new s.StandardMaterial("outputplane",this.scene);a.diffuseTexture=i,a.specularColor=new s.Color3(0,0,0),a.emissiveColor=new s.Color3(1,1,1),a.backFaceCulling=!1},t.prototype.createParticle=function(t){var e=this,n=new s.Vector3(t.x+.1*l.a.getRandomIntInRange(-15,15),t.y+.1*l.a.getRandomIntInRange(-15,15),t.z+.1*l.a.getRandomIntInRange(-15,15)),o=l.a.getRandomIntInRange(0,2),i=this.colorsSetForParticle[o].diffuseColor,r=new s.Color3(i[0],i[1],i[2]),a=.001*l.a.getRandomIntInRange(50,70),c=s.Mesh.CreateSphere("core-colorSetIndex:"+o,2,a,this.scene);c.position=n;var h=c.material=new s.StandardMaterial("coreMaterial",this.scene);h.diffuseColor=r,h.emissiveColor=s.Color3.Black(),this.glowLayerForParticle||(this.glowLayerForParticle=new s.GlowLayer("glowLayerForParticle",this.scene),this.glowLayerForParticle.intensity=.5,this.glowLayerForParticle.customEmissiveColorSelector=function(t,n,o,i){var r=t.name.replace("core-colorSetIndex:",""),a=e.colorsSetForParticle[r].glowColor;i.set(a[0],a[1],a[2],a[3])}),this.glowLayerForParticle.addIncludedOnlyMesh(c);var d=u.a.getRandomVector3();this.particles.push({mesh:c,translateVector:d,duration:this.getDurationForParticle()})},t.prototype.startUpdateTextNodeWorker=function(){var t=this;if(window.Worker){var e=new Worker("dist/UpdateTextNodeWorker.js");e.onmessage=function(n){if(0===t.textNodes.length)return t.linesForLinesystem.length=0,void t.linesystem.dispose();var o;t.linesForLinesystem=n.data,o=[],"Simple"===t.translateType?(o=t.textNodes.map(function(e){return u.a.updatePosition(e.position,e.translateVector,e.scale*Math.cos(t.translateFactor)),e.position}),t.translateFactor+=.01):"ToOrigin"===t.translateType?o=t.textNodes.map(function(t){var e=new s.Vector3(-t.position.x,-t.position.y,-t.position.z).normalize();return u.a.updatePosition(t.position,e,.5),t.position}):"ToChatRoomNode"===t.translateType&&(t.textNodes=t.textNodes.slice(0,t.chatRoomsNodes.length),o=t.textNodes.map(function(e,n){var o=u.a.subtractVector(t.chatRoomsNodes[n],e.position).normalize();return u.a.updatePosition(e.position,o,.5),e.position})),e.postMessage(o)},e.postMessage(this.textNodes)}},t.prototype.translateLinesForTextNodes=function(){0!==this.linesForLinesystem.length&&(this.linesystem=s.MeshBuilder.CreateLineSystem("linesystem",{lines:this.linesForLinesystem,updatable:!0,instance:this.linesystem||null},this.scene),this.linesystem.color=s.Color3.White())},t.prototype.translateParticles=function(){var t=this;if(0!==this.particles.length){this.particles.forEach(function(e){e.duration<=0&&(e.translateVector=u.a.getRandomVector3(),e.duration=t.getDurationForParticle()),u.a.updatePosition(e.mesh.position,e.translateVector,.003),e.duration-=1})}},t.prototype.getDurationForParticle=function(){return l.a.getRandomIntInRange(180,360)},t.prototype.getPoints=function(){var t=this;c.getJSON("apis/getPoints",function(e){var n=[];Object.keys(e).forEach(function(o,i){var r=e[o].map(function(t){return new s.Vector3(t.x,t.y,.006*l.a.getRandomNumber(3))});t.chatRoomsNodes=t.chatRoomsNodes.concat(r),n[i]=r});var o=[];n.forEach(function(e){var n=u.a.getLineToEachOther(e),i=l.a.sort(n,function(t){return t.distance})[n.length-1],r=new s.Vector3(0,0,0);Object.keys(r).forEach(function(t){r[t]=(i.from[t]+i.to[t])/2}),t.chatRoomsCenter.push(r),o=o.concat(n.slice(0,120))}),console.log("line count: "+o.length),t.linesForChatRooms=o})},t.prototype.createBubbleSprayAndParticles=function(){var t=this;this.chatRoomsCenter.forEach(function(e){t.createBubbleSpray(e);for(var n=0;n<10;n++)t.createParticle(e)})},t.prototype.drawLine=function(){var t=this;if(0!==this.linesForChatRooms.length){var e=this.highlightForLine=this.highlightForLine||function(){var t=new s.HighlightLayer("highlightForLine",this.scene);return t.innerGlow=!1,t}.bind(this)(),n=this.colorSetForLines.map(function(e,n){var o=new s.Color3(e[0],e[1],e[2]),i=new s.StandardMaterial("lineMat"+n,t.scene);return i.diffuseColor=o,i}),o=[[],[],[]];this.linesForChatRooms.forEach(function(e,i){var r=l.a.getRandomIntInRange(0,2),a=s.MeshBuilder.CreateTube("line"+i,{path:[e.from,e.to],radius:.03,updatable:!1},t.scene);a.material=n[r],o[r].push(a)}),o.forEach(function(n){if(0!==n.length){var o=s.Mesh.MergeMeshes(n,!0,!1);e.addMesh(o,t.glowColor)}})}},t.prototype.getTexts=function(){var t=this,e=new Image;e.src="assets/textImage/image.png",e.onload=function(){var n=document.createElement("canvas"),o=n.height=e.height,i=n.width=e.width,r=n.getContext("2d");r.drawImage(e,0,0,i,o);for(var a=r.getImageData(64,64,64,64),c=[],h=a.data.length,d=0;d<h;d+=4){var p=a.data[d],f=a.data[d+1],g=a.data[d+2],m=.299*p+.587*f+.114*g,y=d/4+1,v=Math.floor(y/64),w=y%64;c.push({x:w,y:v,r:p,g:f,b:g,brightness:m})}t.textNodes=c.filter(function(t){return t.brightness>100}).map(function(t,e){return{position:new s.Vector3(.15*(t.x-32),-1*(t.y-32)*.15,-15+l.a.getRandomNumberInRange(0,2,2)),scale:l.a.getRandomNumberInRange(-.05,.05,3),translateVector:u.a.getRandomVector3(!1,!1).normalize()}}),t.startUpdateTextNodeWorker()}},t.prototype.transformation=function(){var t=this;this.translateType="ToOrigin",setTimeout(function(){t.translateType="ToChatRoomNode"},5e3),setTimeout(function(){t.translateType=null,t.textNodes.length=0,t.drawLine()},1e4)},t.prototype.zoomIn=function(){var t=l.a.getRandomIntInRange(0,this.chatRoomsCenter.length-1),e=this.chatRoomsCenter[t],n=e?new s.Vector3(3*e.x,3*e.y,0):s.Vector3.Zero(),o=s.Curve3.CreateHermiteSpline(this.camera.position,s.Vector3.Zero(),n,s.Vector3.Zero(),300).getPoints();this.cameraLocations=o},t}(),d=function(){function t(){this.afterWordCardsAnimation=function(){},this.afterLogin=function(){}}return t.prototype.init=function(){gapi.load("client",this.initClient.bind(this)),this.wordCardsAnimation()},t.prototype.fadeAnimation=function(t,e,n){var o=$(t);o.fadeIn(e.fadeIn,void 0,function(){e.fadeOut?setTimeout(function(){o.fadeOut(e.fadeOut,void 0,function(){n()})},e.sustain||0):n()})},t.prototype.fadeSequence=function(t,e,n){var o=this;0!==t.length?(e.fadeOut=t.length>1?e.fadeOut:null,this.fadeAnimation(t.shift(),e,function(){o.fadeSequence(t,e,n)})):n()},t.prototype.wordCardsAnimation=function(){var t=$("#loginPanel > div");this.fadeSequence(t.toArray(),{fadeIn:3e3,sustain:1e3,fadeOut:2e3},this.afterWordCardsAnimation)},t.prototype.initClient=function(){var t=this;gapi.client.init({clientId:"380947346613-l6gvf9laj9fuko3ljph9ej99olo5qa3k.apps.googleusercontent.com",apiKey:"AIzaSyBmozdLmtDDry_ah4NhYPqOTeZ2wr9Er2A",discoveryDocs:["https://people.googleapis.com/$discovery/rest?version=v1"],scope:"profile"}).then(function(){gapi.auth2.getAuthInstance().isSignedIn.get()?t.queryUser():t.setSignInButton()})},t.prototype.setSignInButton=function(){gapi.auth2.getAuthInstance().isSignedIn.listen(this.login.bind(this)),$("#signinButton").on("click",function(){return gapi.auth2.getAuthInstance().signIn()})},t.prototype.queryUser=function(){var t=this;gapi.client.people.people.get({resourceName:"people/me","requestMask.includeField":"person.names"}).then(function(e){var n=e.result.names[0].displayName;t.setLoiginButton(n)})},t.prototype.setLoiginButton=function(t){$("#signInWrapper .buttonText").text(t),$("#signinButton").on("click",this.login.bind(this))},t.prototype.login=function(){var t=$("#loginPanel");t.animate({opacity:0},2e3,function(){return t.hide()}),this.afterLogin()},t}(),p=function(){function t(){this.onTextAdd=null,this.onImageAdd=null}return t.prototype.initPanel=function(t,e){this.onTextAdd=t,this.onImageAdd=e,$("#textInputSwitch").on("click",this.switchTextInput.bind(this)),$("#sent").on("click",this.handleText.bind(this)),$("#fileUpload").on("change",this.handleFiles.bind(this))},t.prototype.switchTextInput=function(){$("#textInput").toggleClass("visible").toggleClass("invisible")},t.prototype.handleText=function(){var t=this,e=$("#textInput>input"),n=String(e.val());if(n){e.val("").focus(),this.onTextAdd(n);var o=$(".mask");o.addClass("flash"),setTimeout(function(){o.removeClass("flash")},500),window.setTimeout(function(){t.onTextAdd(n+"! "+n+"! "+n+"!!!")},700)}},t.prototype.handleFiles=function(t){var e=this,n=t.currentTarget.files[0];if(n){var o=new FileReader;o.addEventListener("load",function(t){var n=t.target.result;e.onImageAdd(n)}),o.readAsDataURL(n),$.get("apis/uploadImage").done(function(t){console.log(t)}).fail(function(t){console.log(t)})}},t}(),f=(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.render=function(){return r.createElement("h1",null,"Len: ",this.props.contents.length)},e}(r.Component);!function(t){t[t.Text=0]="Text",t[t.Image=1]="Image"}(i||(i={}));var m=new d,y=new h;m.afterWordCardsAnimation=y.transformation.bind(y),m.afterLogin=y.zoomIn.bind(y),m.init(),y.init();var v=[{type:i.Text,content:"asdasd"}];(new p).initPanel(function(t){return v.push({type:i.Text,content:t})},function(t){return v.push({type:i.Image,content:t})}),a.render(r.createElement(g,{contents:v}),document.getElementById("MessageBoard"))}]);
//# sourceMappingURL=main.js.map